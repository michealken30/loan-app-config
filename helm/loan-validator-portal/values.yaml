replicaCount: 2
image:
  repository: docker.io/michealken30/loan-validator-portal
  tag: 1f405a7-34
  pullPolicy: Always
nameOverride: ""
fullnameOverride: ""
# AWS IRSA
serviceAccount:
  create: true
  name: loan-validator-portal-sa
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::<ACCOUNT_ID>:role/loan-validator-portal-role
# Prometheus scraping
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"
# Pod-level security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  fsGroup: 65532
  seccompProfile:
    type: RuntimeDefault
# Container-level security
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65532
  capabilities:
    drop:
      - ALL
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
# Resource management
resources:
  limits:
    cpu: 300m
    memory: 256Mi
  requests:
    cpu: 150m
    memory: 128Mi
# Horizontal Pod Autoscaling
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70
# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3
readinessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
# External Secrets Operator
externalSecrets:
  enabled: true
  secretStore:
    name: aws-secrets-manager
    kind: SecretStore
  secrets:
    - name: loan-validator-portal-secret
      remoteRef:
        key: loan-app/loan-validator-portal
      data:
        - secretKey: JWT_SECRET
          remoteKey: jwt_secret
        - secretKey: API_KEY
          remoteKey: api_key
# Application config
configMap:
  GOVERNMENT_API_BASE_URL: "http://government-api.government-api.svc.cluster.local:8081"
  PORT: "8080"
  ENVIRONMENT: "production"
  LOG_LEVEL: "info"
  DB_HOST: "postgres-service.database.svc.cluster.local"
  DB_PORT: "5432"
  DB_USER: "postgres"
  DB_NAME: "loan_validator_db"
# Zero-trust networking
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - namespaceSelector:
            matchLabels:
              name: government-api
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: government-api
      ports:
        - protocol: TCP
          port: 8081
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 53
        - protocol: UDP
          port: 53
